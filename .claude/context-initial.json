{
  "task_marker": "20251113-153000-0001",
  "generated_at": "2025-11-13T22:17:59Z",
  "project_location": {
    "path": "install.sh",
    "role": "Root-level interactive Bash installer that prepares Claude Code + Codex by checking dependencies, templating Claude desktop configs, installing MCP servers, and scaffolding the .claude workspace across macOS/Linux/Windows Git Bash."
  },
  "current_implementation": {
    "flow": [
      "main() \u2192 check_dependencies \u2192 create_config_dir \u2192 choose_config (sets TEMPLATE_FILE/CONFIG_LEVEL) \u2192 optional get_exa_api_key \u2192 generate_config \u2192 create_working_directories \u2192 install_packages_by_config \u2192 verify_installation \u2192 show_completion"
    ],
    "utility_functions": [
      "Colorized print_* helpers standardize INFO/WARNING/ERROR output for the script",
      "detect_os()/get_claude_config_dir() resolve the per-OS Claude desktop path using OSTYPE and $APPDATA",
      "create_config_dir() ensures the Claude config directory exists, while create_working_directories() builds the companion .claude tree (shrimp,codex,context,logs,cache) alongside it"
    ],
    "config_generation": "generate_config() copies the selected template (config-simple.json, claude-desktop-config.json, or config-advanced.json) into <Claude>/claude_desktop_config.json via sed; when an Exa key is provided it substitutes 'your-exa-api-key-here', otherwise it deletes the entire exa block before writing.",
    "package_management": "install_packages_by_config() dispatches to install_basic|standard|all, installing npm -g packages (@modelcontextprotocol/server-sequential-thinking, mcp-shrimp-task-manager, chrome-devtools-mcp@latest, exa-mcp-server) and always calling check_codex plus install_code_index(); install_code_index() bootstraps uvx via 'pip install uv' before running 'uvx code-index-mcp --help'.",
    "dependency_assumptions": [
      "check_dependencies() enforces node, npm, python3, and pip but assumes tools like sed, jq, curl, and uvx already exist",
      "Codex CLI must already be installed; check_codex() only warns if 'codex' is missing"
    ],
    "validation": "verify_installation() merely checks for the presence of claude_desktop_config.json in the resolved Claude directory; it does not parse JSON, confirm MCP entries, or confirm package installs succeeded.",
    "user_interaction": "choose_config() is fully interactive (read prompts for options 1-3), and the advanced path optionally collects an Exa API key via hidden input; there are no CLI flags for automation."
  },
  "similar_cases": [
    {
      "file": "check-skill-health.sh",
      "role": "Health-check utility for the codex-workflow skill; validates .claude/skills assets, template presence, JSON syntax via python3, MCP entries with jq, Codex availability, working directory structure, and required tools before summarizing pass/fail stats.",
      "notable_behaviors": [
        "Creates missing .claude subdirectories on the fly",
        "Warns (instead of failing) when Codex or npm packages are absent",
        "Shares colorized terminal output conventions with install.sh"
      ]
    },
    {
      "file": "verify-config.sh",
      "role": "Post-install validator focused on Claude desktop config integrity; checks for node/npm/python3/pip, ensures the OS-specific config directory and claude_desktop_config.json exist, formats JSON via python -m json.tool, heuristically inspects API key placeholders, probes OpenAI API reachability with curl, and runs MCP server version commands (npx sequential-thinking, codex, shrimp).",
      "notable_behaviors": [
        "Counts TOTAL/PASSED/FAILED checks for a final summary",
        "Relies on curl network access and assumes codex CLI is globally installed",
        "Exits non-zero when validation fails, intended as troubleshooting companion to install.sh"
      ]
    }
  ],
  "tech_stack": {
    "languages": [
      "Bash",
      "JSON"
    ],
    "cli_dependencies": [
      "Node.js (>=16) with npm/npx",
      "Python 3.8+ with pip",
      "uv/uvx for code-index-mcp",
      "Codex CLI (stdio MCP server)",
      "curl and jq (used by verification scripts)",
      "sed/mkdir/coreutils for filesystem operations"
    ],
    "mcp_servers": [
      "@modelcontextprotocol/server-sequential-thinking",
      "mcp-shrimp-task-manager",
      "codex mcp-server",
      "code-index-mcp (via uvx)",
      "chrome-devtools-mcp@latest",
      "exa-mcp-server"
    ],
    "platform_support": [
      "macOS: ~/Library/Application Support/Claude",
      "Linux: ~/.config/claude",
      "Windows (Git Bash/msys/cygwin): $APPDATA/Claude"
    ],
    "documentation_sources": [
      "README.md",
      "QUICKSTART.md",
      "README-config.md",
      "advanced.md",
      "api.md",
      "troubleshooting.md",
      "SKILL-GUIDE.md",
      "SKILL-QUICKREF.md"
    ],
    "external_services": [
      "OpenAI API (verify-config.sh probes https://api.openai.com)",
      "Exa API (optional advanced search integration)",
      "Chrome DevTools protocol (via chrome-devtools-mcp)"
    ]
  },
  "testing_info": {
    "automated_tests": "No automated unit/system tests or CI scripts exist in the repository; validation is entirely manual.",
    "scripts": [
      {
        "file": "check-skill-health.sh",
        "purpose": "Runs a battery of structural and dependency checks against the .claude/skills/codex-workflow assets, validates JSON templates with python3, inspects MCP config via jq, and reports pass/warn/fail counts."
      },
      {
        "file": "verify-config.sh",
        "purpose": "Ensures Claude desktop config files exist and are syntactically valid, checks API key placeholders, tests OpenAI connectivity with curl, and calls MCP server binaries to confirm availability."
      }
    ],
    "documentation": [
      "TESTING-GUIDE.md provides a multi-step manual test plan covering skill activation and Codex response sizes.",
      "TEST-QUICK-START.md summarizes prerequisites for running manual tests.",
      "TEST-RESULT-TEMPLATE.md gives a markdown form for recording outcomes."
    ],
    "coverage_gaps": "install.sh success criteria stop at file existence; there are no assertions for npm global installs, uvx availability, or Codex health beyond manual inspection."
  },
  "config_files": [
    {
      "file": "config-simple.json",
      "purpose": "Minimal MCP stack for newcomers combining sequential-thinking and codex with shared WORKING_DIR=.claude.",
      "mcpServers": [
        "sequential-thinking (npx @modelcontextprotocol/server-sequential-thinking)",
        "codex (codex mcp-server)"
      ],
      "workflow": {
        "execution_order": [
          "sequential-thinking",
          "codex"
        ],
        "working_directory": ".claude",
        "data_directories": {
          "codex": ".claude/codex",
          "context": ".claude/context",
          "logs": ".claude/logs"
        }
      }
    },
    {
      "file": "claude-desktop-config.json",
      "purpose": "Standard template used by install.sh when CONFIG_LEVEL=standard; adds shrimp-task-manager and code-index to the simple stack.",
      "mcpServers": [
        "sequential-thinking",
        "shrimp-task-manager (npx mcp-shrimp-task-manager with DATA_DIR .claude/shrimp, zh templates)",
        "codex",
        "code-index (uvx code-index-mcp)"
      ],
      "workflow": {
        "execution_order": [
          "sequential-thinking",
          "shrimp-task-manager",
          "codex"
        ],
        "working_directory": ".claude",
        "data_directories": {
          "shrimp": ".claude/shrimp",
          "codex": ".claude/codex",
          "context": ".claude/context",
          "logs": ".claude/logs"
        }
      }
    },
    {
      "file": "config-advanced.json",
      "purpose": "Enterprise-style template that layers chrome-devtools and exa search on top of the standard stack and introduces cache storage.",
      "mcpServers": [
        "sequential-thinking",
        "shrimp-task-manager",
        "codex",
        "code-index",
        "chrome-devtools (npx chrome-devtools-mcp@latest)",
        "exa (npx -y exa-mcp-server with EXA_API_KEY placeholder)"
      ],
      "workflow": {
        "execution_order": [
          "sequential-thinking",
          "shrimp-task-manager",
          "codex",
          "code-index",
          "chrome-devtools",
          "exa"
        ],
        "working_directory": ".claude",
        "data_directories": {
          "shrimp": ".claude/shrimp",
          "codex": ".claude/codex",
          "context": ".claude/context",
          "logs": ".claude/logs",
          "cache": ".claude/cache"
        }
      }
    }
  ],
  "observations": {
    "issues": [
      "generate_config() removes the 'exa' block with sed '/exa/,/}/d' when no key is provided, leaving the trailing comma from the preceding chrome-devtools entry in config-advanced.json; the resulting claude_desktop_config.json becomes invalid JSON whenever users skip the Exa key in advanced mode.",
      "install_code_index() depends on 'pip install uv' but never accounts for pip pointing at Python 2 or needing elevated permissions, so code-index-mcp may remain unavailable even though the script reports success."
    ],
    "risks": [
      "check_dependencies() ignores jq, curl, uvx, and Codex despite later scripts requiring them, causing downstream health checks to fail unexpectedly.",
      "verify_installation() only looks for a file on disk; it neither validates JSON nor ensures required MCP entries exist, so misconfigured installs may falsely report success.",
      "README quickstart suggests running 'curl ... | bash install.sh' even though the script prompts for configuration choices, making unattended automation brittle and prone to hanging waiting for user input."
    ],
    "opportunities": [
      "Add non-interactive flags (e.g., --config-level, --exa-key) and default answers so install.sh can be scripted and re-run idempotently.",
      "Centralize MCP server definitions (single data source feeding both templates and docs) to prevent the JSON configs and documentation from diverging during future refactors.",
      "Extend post-install validation to run npm list/uvx smoke tests and optionally call check-skill-health.sh for end-to-end verification."
    ]
  }
}
